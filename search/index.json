[{"content":"预置条件 kernel开启相关配置项：\nCONFIG_9P_FS=y CONFIG_9P_FS_POSIX_ACL=y CONFIG_9P_FS_SECURITY=y CONFIG_NETWORK_FILESYSTEMS=y CONFIG_NET_9P=y CONFIG_NET_9P_DEBUG=y CONFIG_NET_9P_VIRTIO=y CONFIG_PCI=y CONFIG_PCI_HOST_COMMON=y CONFIG_PCI_HOST_GENERIC=y CONFIG_VIRTIO_PCI=y CONFIG_VIRTIO_BLK=y CONFIG_VIRTIO_NET=y CONFIG_VIRTIO_MMIO=y CONFIG_FUSE_FS=y CONFIG_VIRTIO_FS=y CONFIG_VIRTIO_INPUT=y 宿主机支持相关库\nsudo apt install -y libcap-dev sudo apt install -y libattr sudo apt install -y libattr-dev qemu编译支持virtfs\n./configure --target-list=aarch64-softmmu --enable-kvm --enable-virtfs --enable-slirp --enable-debug 执行步骤 path/to/share：设置成自己在宿主机的要共享的目录\nqemu-system-aarch64 \\ -M virt,secure=on -m 4G -nographic \\ -machine firmware=bl31.bin \\ -fsdev local,id=shareid,path=/path/to/share,security_model=none \\ -device virtio-9p-device,fsdev=shareid,mount_tag=share \\ -device loader,addr=0x1002000000,file=tee.elf \\ --kernel Image \\ --initrd rootfs.cpio.gz ","date":"2023-06-24T18:25:36+08:00","permalink":"https://hyrtee.github.io/2023/qemu-9pfs/","title":"qemu使用9pfs共享宿主机文件"},{"content":"搭建环境 操作系统：windows 10 开发工具：vscode、Git 搭建思路 使用四个仓库，管理Blog，分别是：\n源仓库：private，托管所有配置文件 发布仓库：public，托管Github pages内容仓库 主题仓库：public，托管当前使用的主题自定义内容 评论仓库：public，托管blog文章评论信息 使用Github Action：当源仓库有push时，自动生成静态页面到username.github.io域名下\n安装 hugo 由于Stack要求SCSS 和 TypeScript，所以需要下载extend版本：Releases · gohugoio/hugo · GitHub\nStack要求hugo最低版本 → theme\u0026rsquo;s theme.toml file\n安装完成后，重启terminal，check version： 新建 site 选择 or 新建一个文件夹，用于管理自己的blog，作者使用的是D:\\code\\blog新建site，拉取stack作为module：\nhugo new site hugostack cd hugostack git init git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack 将themes/hugo-theme-stack/exampleSite子目录下的文件拷贝到根目录下：\ncp -r themes/hugo-theme-stack/exampleSite/* ./ # 删除根目录下默认的配置文件，不同hugo版本各有不同：hugo.toml/config.yaml rm hugo.toml 尝试本地运行\nhugo server -D bug 1：languages.en.description: custom params on the language top level is deprecated and will be removed in a future release.\nWARN 2023/06/23 10:15:21 config: languages.en.description: custom params on the language top level is deprecated and will be removed in a future release. Put the value below [languages.en.params]. See https://gohugo.io/content-management/multilingual/#changes-in-hugo-01120 Re-run Hugo with the flag --panicOnWarning to get a better error message. WARN 2023/06/23 10:15:21 config: languages.zh-cn.description: custom params on the language top level is deprecated and will be removed in a future release. Put the value below [languages.zh-cn.params]. See https://gohugo.io/content-management/multilingual/#changes-in-hugo-01120 Re-run Hugo with the flag --panicOnWarning to get a better error message. WARN 2023/06/23 10:15:21 config: languages.ar.description: custom params on the language top level is deprecated and will be removed in a future release. Put th Re-run Hugo with the flag --panicOnWarning to get a better error message. 解决：大致含义是新的hugo版本会逐渐舍弃自定义language参数，所以将config.yaml中的language中的title和description字段，以及语言ar去掉：\nlanguages: en: languageName: English weight: 1 zh-cn: languageName: 中文 weight: 2 bug 2：error calling partial: partial \u0026ldquo;article/article.html\u0026rdquo; timed out after 30s. This is most likely due to infinite recursion. If this is just a slow template, you can try to increase the \u0026rsquo;timeout\u0026rsquo; config setting.\nERROR 2023/06/23 10:46:27 render of \u0026quot;home\u0026quot; failed: \u0026quot;D:\\code\\blog\\hugostack\\themes\\hugo-theme-stack\\layouts\\index.html:9:15\u0026quot;: execute of template failed: template: index.html:9:15: executing \u0026quot;main\u0026quot; at \u0026lt;partial \u0026quot;article-li15: executing \u0026quot;main\u0026quot; at \u0026lt;partial \u0026quot;article-list/default\u0026quot; .\u0026gt;: error calling partial: \u0026quot;D:\\code\\blog\\hugostack\\themes\\hugo-theme-stack\\layouts\\partials\\article-list\\default.html:3:rtials/article-list/default.html:3:7: execut7\u0026quot;: execute of template failed: template: partials/article-list/default.html:3:7: executing \u0026quot;partials/article-list/default.html\u0026quot; at \u0026lt;partial \u0026quot;article/components/header\u0026quot; .\u0026gt;: erricle\\components\\header.html:34:7\u0026quot;: execute oor calling partial: \u0026quot;D:\\code\\blog\\hugostack\\themes\\hugo-theme-stack\\layouts\\partials\\article\\components\\header.html:34:7\u0026quot;: execute of template failed: template: partials/articl.RelPermalink\u0026gt;: error calling partialCached:e/components/header.html:34:7: executing \u0026quot;partials/article/components/header.html\u0026quot; at \u0026lt;partialCached \u0026quot;article/components/details\u0026quot; . .RelPermalink\u0026gt;: error calling partialCached: config setting. partial \u0026quot;article/components/details\u0026quot; timed out after 30s. This is most likely due to infinite recursion. If this is just a slow template, you can try to increase the 'timeout' config setting. of template failed: template: _default/sing Built in 30147 ms nite recursion. If this is just a slow templ Error: error building site: render: failed to render pages: render of \u0026quot;page\u0026quot; failed: \u0026quot;D:\\code\\blog\\hugostack\\themes\\hugo-theme-stack\\layouts\\_default\\single.html:27:7\u0026quot;: execute of template failed: template: _default/single.html:27:7: executing \u0026quot;main\u0026quot; at \u0026lt;partial \u0026quot;article/article.html\u0026quot; .\u0026gt;: error calling partial: partial \u0026quot;article/article.html\u0026quot; timed out after 30s. This is most likely due to infinite recursion. If this is just a slow template, you can try to increase the 'timeout' config setting. 解决：\n首先，科学上网\n其次，在根目录的config.yaml中添加timeout字段，默认是30s，增大到10m：\n# large timeout timeout : \u0026quot;10m\u0026quot; success！\n关联仓库 本地已有源仓库和主题仓库，需要将其关联到远程：\n远程源仓库：新建一个，设置属性为private，如：/username/hugostack.git\n远程主题仓库：fork之前submodule的主题仓库到自己的github\n# 关联到远程 git remote add origin https://github.com/username/hugostack.git cd themes/hugo-theme-stack/ git remote set-url origin https://github.com/username/hugo-theme-stack.git 测试push\ngit push -u origin master cd themes/hugo-theme-stack/ git push 设置Github Action 远程新建发布仓库，命名为：username.github.io。这里的username是github的用户名，必须保持一致！\n本地源仓库下：\n设置config.yaml中的baseurl为：https://username.github.io 新建文件夹和文件：.github/workflows/deploy-site.yaml，填入如下内容： name: deploy on: push: branches: [\u0026quot;master\u0026quot;] workflow_dispatch: # schedule: # # Runs everyday at 8:00 AM # - cron: \u0026quot;0 0 * * *\u0026quot; # Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages permissions: contents: read pages: write id-token: write # Allow one concurrent deployment concurrency: group: \u0026quot;pages\u0026quot; cancel-in-progress: true # Default to bash defaults: run: shell: bash jobs: # BUild job build: runs-on: ubuntu-latest env: HUGO_VERSION: 0.113.0 TZ: America/Los_Angeles steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo id: pages uses: peaceiris/actions-hugo@v2 with: hugo-version: '0.113.0' extended: true - name: Build Hugo env: # For maximum backward compatibility with Hugo modules HUGO_ENVIRONMENT: production HUGO_ENV: production run: hugo --minify - name: Deploy Web id: deployment uses: peaceiris/actions-gh-pages@v3 with: PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN }} EXTERNAL_REPOSITORY: hyrtee/hyrtee.github.io PUBLISH_BRANCH: main PUBLISH_DIR: ./public commit_message: ${{ github.event.head_commit.message }} push到远程\nbug 3：refusing to allow an OAuth App to create or update workflow .github/workflows/deploy-site.yaml without workflow scope\n解决：暂时删除本地的.github/workflows/deploy-site.yaml，包括文件夹，先将其他修改push到远程，随后在github源仓库的Action页面下，新建一个workflows，将上面的deploy-site.yaml内容粘贴到其中。\nbug 4：执行Action失败，Action failed with \u0026ldquo;not found deploy key or tokens\u0026rdquo;\n解决：\n新建一个token，enable repo和workflow，复制token。\n在源仓库的Settings - Secrets and variables - Actions中，添加一个secret，将之前新建的token复制其中\nAction下rerun之前的job：\n访问https://hyrtee.github.io/，success！\n自定义 Blog Style 左侧信息栏 头像 根目录下新建assets/img，添加自己的头像img，随后修改对应config文件的img名称：src\nsidebar: emoji: 🍥 subtitle: MARiA? yyds! avatar: enabled: true local: true src: img/avatar.png 社交social 自定义图标，iconfont 下载，颜色#2c3e50，大小24，格式svg。下载后放到assets\\icons\nsocial: - identifier: github name: GitHub url: https://github.com/hyrtee weight: 1 params: icon: img-name 注意：将下载的img中的svg的所有#2c3e50改成currentColor，否则切换为黑色模式，图标颜色不能自动切换，因为优先使用内部定义的color\n文档 Emoji config中添加如下内容\n# Enable global emoji support enableEmoji: true 随后直接在文章的md文档中添加emoji id即可显示，查询id：emoji-cheat-sheet\nLanguage 如果只想保持一种语言，则config中的language只保留一种语言，如中文：\nlanguages: zh-cn: languageName: 中文 weight: 1 评论 使用utterances，操作简单：\ngithub新建一个评论仓库hyrteeblogtalks github安装utterances，并关联上面的评论仓库 修改config.yaml comments: enabled: true provider: utterances disqusjs: shortname: apiUrl: apiKey: admin: adminLabel: utterances: repo: hyrtee/hyrteeblogtalks issueTerm: title theme: github-light 效果： 统计分析 使用不蒜子工具，使用简单，只需导入两行代码，官网是这么说的，实际DIY也还行。\n导入busuanzi js脚本 在layouts\\partials\\head\\head.html文件末尾：\n\u0026lt;!-- busuanzi --\u0026gt; {{- if .Site.Params.busuanzi.enable -}} \u0026lt;script async src=\u0026quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;meta name=\u0026quot;referrer\u0026quot; content=\u0026quot;no-referrer-when-downgrade\u0026quot;\u0026gt; {{- end -}} 全局统计 底部显示本站总访问量和访客数，在layouts\\partials\\footer\\footer.html文件：\n\u0026lt;section class=\u0026quot;copyright\u0026quot;\u0026gt; \u0026amp;copy; \u0026lt;!-- {{ if and (.Site.Params.footer.since) (ne .Site.Params.footer.since (int (now.Format \u0026quot;2006\u0026quot;))) }} {{ .Site.Params.footer.since }} - {{ end }} --\u0026gt; {{ now.Format \u0026quot;2006\u0026quot; }} \u0026lt;a href=\u0026quot;https://stack-theme-mod.vercel.app/\u0026quot;\u0026gt;Hyrtee\u0026lt;/a\u0026gt;\u0026lt;i class=\u0026quot;fas fa-bell\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; ·\u0026lt;i class=\u0026quot;fas fa-bell\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;a id=\u0026quot;days\u0026quot;\u0026gt;0\u0026lt;/a\u0026gt;Days\u0026lt;br\u0026gt; {{$var := $scratch.Get \u0026quot;total\u0026quot;}}{{$var = div $var 100.0}}{{$var = math.Ceil $var}}{{$var = div $var 10.0}}共书写了{{$var}}k字·共 {{ len (where .Site.RegularPages \u0026quot;Section\u0026quot; \u0026quot;post\u0026quot;) }}篇文章 \u0026lt;!-- 以上是文件原内容，以下是添加部分 --\u0026gt; \u0026lt;!-- insert busuanzi --\u0026gt; {{ if .Site.Params.busuanzi.enable -}} \u0026lt;div class=\u0026quot;busuanzi-footer\u0026quot;\u0026gt; \u0026lt;span id=\u0026quot;busuanzi_container_site_pv\u0026quot;\u0026gt; 本站总访问量\u0026lt;span id=\u0026quot;busuanzi_value_site_pv\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;次 \u0026lt;/span\u0026gt; \u0026lt;span id=\u0026quot;busuanzi_container_site_uv\u0026quot;\u0026gt; 本站访客数\u0026lt;span id=\u0026quot;busuanzi_value_site_uv\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;人次 \u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; {{- end -}} \u0026lt;/section\u0026gt; 效果： 单个文章统计 头部显示文章阅读量，layouts\\partials\\article\\components\\details.html文件的footer内结尾：\n{{ if .Site.Params.article.readingTime }} \u0026lt;div\u0026gt; {{ partial \u0026quot;helper/icon\u0026quot; \u0026quot;clock\u0026quot; }} \u0026lt;time class=\u0026quot;article-words\u0026quot;\u0026gt; {{ .WordCount }}字 \u0026lt;/time\u0026gt; \u0026lt;/div\u0026gt; {{ end }} \u0026lt;!-- 以上是文件原内容，以下是添加部分 --\u0026gt; \u0026lt;!-- busuanzi --\u0026gt; {{ if .Site.Params.busuanzi.enable -}} \u0026lt;div class=\u0026quot;article-analysic\u0026quot;\u0026gt;\u0026amp;nbsp \u0026lt;!-- 这里的read图标，可自行前往iconfont下载 --\u0026gt; {{ partial \u0026quot;helper/icon\u0026quot; \u0026quot;read\u0026quot; }} \u0026lt;time class=\u0026quot;article-words\u0026quot;\u0026gt; \u0026lt;span id=\u0026quot;busuanzi_container_page_pv\u0026quot;\u0026gt;\u0026lt;span id=\u0026quot;busuanzi_value_page_pv\u0026quot;\u0026gt;\u0026lt;/span\u0026gt; \u0026amp;nbsp阅读\u0026lt;/span\u0026gt; \u0026lt;/time\u0026gt; \u0026lt;/div\u0026gt; {{- end }} 原版可能需要在themes/stack/layouts/_default/single.html中修改 技巧：无论使用什么版本的stack，默认情况下，单篇文章顶部都会显示字数或需要阅读几分钟，所以vscode搜\u0026quot;字\u0026quot;或\u0026quot;分钟\u0026quot;等关键字，看对应代码在哪个文件，就在哪里添加以上代码，屡试不爽！ 效果： ## 让谷歌\u0026amp;百度搜到我\n### 谷歌\n获取谷歌分析ID 首先前往谷歌分析官网，获取Measurement ID，具体操作跟随网站指引即可，名称随意，最终获得一个G-开头的Measurement ID。 打开config.yaml配置文件，找到googleAnalytics配置项，填入你的Measurement ID。\n提交站点地图 站点地图(sitemap)一般是一个XML文件，就是告诉搜索引擎，你的网站有哪些页面，让他来爬取你。Hugo会在生成和部署网站时在public文件夹根目录下自动生成sitemap.xml文件。\n登录谷歌搜索控制台。在验证所有权的选项中选择“Google Analytics”。\n然后点击侧边栏的【站点地图】页面就可以提交我们主页的站点地图URL: ### 百度\n获取js脚本 登陆百度统计主页 ，按照指引，添加网站、获取统计代码。将代码放到themes/hugo-theme-stack/layouts/partials/head/head.html最后，一次性安装，全站皆可被搜索到。如作者：\n\u0026lt;script\u0026gt; var _hmt = _hmt || []; (function() { var hm = document.createElement(\u0026quot;script\u0026quot;); hm.src = \u0026quot;https://hm.baidu.com/hm.js?c376f3e13b35b80fa5d4695e8dd859b1\u0026quot;; var s = document.getElementsByTagName(\u0026quot;script\u0026quot;)[0]; s.parentNode.insertBefore(hm, s); })(); \u0026lt;/script\u0026gt; 提交站点视图 登陆百度搜索资源平台 添加站点，下载验证文件，然后把验证文件放在网站public文件夹内。点击“验证”即可。 选择左侧菜单→普通收录→sitemap→提交站点地图URL 可能由于博客刚建立，被认为是低质站点，过几天再来看看。。。😭😭😭\n## 使用魔改的stack 偶然发现一个使用stack的博主使用了某位大佬的魔改stack版本，觉得还不错，就升级了一下。相比之前，有以下变化：\n调整文章页面为三栏显示（代码来自ShadowySpirits） 文章按年份分类 增加文章字数统计与站点总字数、总篇数显示 修改全站字体为思源宋体 增加一个引用短代码（短代码来自荷戟独彷徨） 添加一个友情链接页面并设置为双栏（友情链接代码来自Bore，双栏代码来自BB_Roin） 一系列基于个人美观喜好的CSS修改 右侧栏增加Categories小部件 仓库的readme已说明需要修改的点，如头像和底部博客创建天数等。 作者直接替换掉content，按照readme说明修改。 bug 5：小改之后，出现底部部分信息不显示问题：\n原版： 魔改版： 解决：直接替换themes/下的stack为之前的最新版本，若文件夹名称修改，需要同步到config.yaml中开头的theme字段 refs https://stack.jimmycai.com/\n如何用 GitHub Pages + Hugo 搭建个人博客\nhttps://blog.reincarnatey.net/2023/build-hugo-blog-with-stack-mod/\nhttps://blog.kanikig.xyz/hugo-busuanzi/\n","date":"2023-06-24T11:11:25+08:00","permalink":"https://hyrtee.github.io/2023/start-blog/","title":"hugo+Stack 搭建个人博客"}]